<!DOCTYPE html>
<html layout:decorator="layout">
<body>
	<div layout:fragment="content">
	
		<button type="button" class="btn btn-default" data-toggle="modal" data-target="#addEditFolderModal"
				data-mode="add" data-isroot="false" th:attr="data-parentid=${folderId}">
			<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
			New folder
		</button>
		<table class="table table-striped table-hover" th:unless="${#lists.isEmpty(subfolders)}">
			<thead>
				<tr>
					<th></th>
					<th>Folder name</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="folder: ${subfolders}">
					<td class="col-icon"><span class="glyphicon glyphicon-folder-open"></span></td>
					<td><a th:href="@{'/folders/' + ${folder.id}}"
							th:text="${folder.name}">Static folder</a></td>
					<td class="col-actions">
						<button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#addEditFolderModal" data-mode="edit"
								th:attr="data-id=${folder.id},data-name=${folder.name},data-isroot=${folder.isRoot},data-parentid=${folderId}">
							<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
						</button>
						<button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#deleteFolderModal"
								th:attr="data-id=${folder.id},data-name=${folder.name}">
							<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
						</button>
					</td>
				</tr>
			</tbody>
		</table>
		
		<button type="button" class="btn btn-default" data-toggle="modal"
				data-target="#addEditTaskModal" data-mode="add" th:attr="data-folderid=${folderId}">
			<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
			New task
		</button>
		<div class="empty" th:if="${#lists.isEmpty(subfolders) and #lists.isEmpty(tasks)}">Empty folder</div>
		<table class="table table-striped table-hover" th:unless="${#lists.isEmpty(tasks)}">
			<thead>
				<tr>
					<th></th>
					<th>Task name</th>
					<th>Due date</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="task: ${tasks}" class="data-holder" th:classappend="${task.isOverdue()} ? 'danger' : ''"
						th:attr="id=${task.id},data-name=${task.name},data-description=${task.description},
								data-status=${task.status},data-duedate=${task.dueDate},data-duedateinfo=${task.dueDateInfo()},
								data-datepostponed=${task.datePostponed},data-datefinished=${task.dateFinished}">
					<td class="col-icon"><span class="glyphicon glyphicon-play"></span></td>
					<td><button th:text="${task.name}" type="button" class="btn btn-link" data-toggle="modal"
							th:attr="data-id=${task.id}" data-target="#displayTaskModal">Static task</button></td>
					<td class="col-duedate">
						<span th:unless="${task.dueDate} == null" th:text="${task.dueDate} + ' (' + ${task.dueDateInfo()} + ')'">Static due date</span>
					</td>
					<td class="col-actions">
						<button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#addEditTaskModal"
								th:attr="data-id=${task.id},data-folderid=${folderId}" data-mode="edit">
							<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
						</button>
						<button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#deleteTaskModal"
								th:attr="data-id=${task.id},data-name=${task.name}">
							<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
						</button>						
					</td>
				</tr>
			</tbody>
		</table>
		
	</div>
	
	<div layout:fragment="modal">
	
		<th:block th:replace="fragments/modals :: folder"></th:block>
		
		<div class="modal fade" id="addEditTaskModal" tabindex="-1" role="dialog" aria-labelledby="addEditTaskModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="addEditTaskModalLabel" data-add="New Task" data-edit="Edit Task"></h4>
					</div>
					<div class="modal-body">
						
						<form id="addEditTaskForm" method="post" th:object="${task}"
								th:attr="data-add=@{/tasks},data-edit=@{/tasks/00/edit}">
							<div class="form-group">
								<label for="taskName">Name:</label>
								<input id="taskName" class="form-control" type="text" th:field="*{name}"
										required="required" placeholder="Task name" />
							</div>
							<div class="form-group">
								<label for="taskDescription">Description:</label>
								<textarea id="taskDescription" class="form-control" rows="3" th:field="*{description}"
										placeholder="Task description"></textarea>
							</div>
							<div class="form-group">
								<label for="taskDueDate">Due date:</label>
								<input id="taskDueDate" class="form-control" type="text" th:field="*{dueDate}"
										placeholder="Task due date" />
							</div>
							<input id="taskStatus" type="hidden" th:field="*{status}" />
							<input id="taskDatePostponed" type="hidden" th:field="*{datePostponed}" />
							<input id="taskDateFinished" type="hidden" th:field="*{dateFinished}" />
							<input id="taskFolderId" type="hidden" name="folderId" />
						</form>
						
					</div>
					<div class="modal-footer">
						<button type="submit" id="addEditTaskSubmit" form="addEditTaskForm" class="btn btn-primary"
								data-add="Add" data-edit="Edit"></button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="deleteTaskModal" tabindex="-1" role="dialog" aria-labelledby="deleteTaskModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="deleteTaskModalLabel">Delete Task</h4>
					</div>
					<div class="modal-body">
						<span id="taskConfirmation">
							Are you sure you want to delete this task (<span class="task-name"></span>)?
						</span>
					</div>
					<div class="modal-footer">
						<form id="deleteTaskForm" class="form-inline" method="POST" th:action="@{/tasks/00/delete}">
							<button type="submit" class="btn btn-primary">Yes</button>
							<button type="button" id="taskNo" class="btn btn-default" data-dismiss="modal">No</button>
						</form>
					</div>
				</div>
			</div>
		</div>
		
		<th:block th:replace="fragments/modals :: displayTask"></th:block>
		
	</div>
	
	<th:block layout:fragment="custom-scripts">
		<script th:src="@{/assets/js/folder-bs-modals.js}"></script>
		<script th:src="@{/assets/js/task-bs-modals.js}"></script>
		<script th:src="@{/assets/js/display-task-bs-modals.js}"></script>
		<script>
		    $('#taskDueDate').datepicker({
		        autoclose: true,
		        todayHighlight: true,
		        format: "yyyy-mm-dd"
		    });
	    </script>
	</th:block>
</body>
</html>